<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>無標題文件</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=true_or_false
      &amp;key=ABQIAAAASjhnTxkK4PHeTvotGA4KwRTQ5BsKmbHJTAiFcX8GQ-SBdwobzBSE-O4SbValEo6XyYc42W7BlewB4g"
      type="text/javascript">
    </script>
    <script language="javascript">
	<!--
	 //<!CDATA[
	 
	    GMarker.prototype.setIndex=function(index){
		  this.index=index;
		}
		
		var myIcon=new GIcon(G_DEFAULT_ICON,"http://www.google.com/mapfiles/marker.png");
		
	    var map;
		var polyline;
		var markers=[];
	    function load(){
		  if(GBrowserIsCompatible()){
 		    map=new GMap2(document.getElementById("map"));
			map.addControl(new GMapTypeControl());
			map.addControl(new GLargeMapControl(),new GControlPosition(G_ANCHOR_TOP_LEFT,new GSize(10,10)));
			map.addControl(new GSmallMapControl(),new GControlPosition(G_ANCHOR_BOTTOM_RIGHT,new GSize(10,10)));
			map.addControl(new GScaleControl());
			var gpoint1=new GLatLng(25.0579805152913,121.5400743484497);
			map.setCenter(gpoint1,16);
					   
			GEvent.addListener(map,"click",function(overlay,point){
              if(point){
			    createMarker(point);
			  }
			})    
				
			
		  }else{
		    alert("無法載入 GoogleMap 地圖！！！");
		  }			  		  		  
		}
		
		
		function createMarker(point){

		  var marker=new GMarker(point,{icon:myIcon,draggable:true,bouncy:true});
		  var index=markers.length;
		  
		  GEvent.addListener(marker,"dblclick",function(){
		    removeMarker(marker);
		  });
		  
		  
		  GEvent.addListener(marker,"dragstart",function(){
		    marker.setImage("http://www.google.com/mapfiles/dd-start.png");
		  });
		  
		  
		  GEvent.addListener(marker,"drag",function(){
		    replayDraw();		  
		  });
		  
		  GEvent.addListener(marker,"dragend",function(){
			marker.setImage("http://www.google.com/mapfiles/marker.png");  
		  });
		  
		  GEvent.addListener(marker,"click",function(){
		    marker.openInfoWindowHtml("您要做些什麼？？？");
		  });
		  
		  marker.setIndex(index);
		  markers[index]=marker;
		  map.addOverlay(marker);
		  	
          replayDraw();				  
		}
		
		
		
		
		function removeMarker(marker){		
		  if(!confirm("您確定要刪除錙點嗎？")){ return; }
		  var index=marker.index;
          		  
		  for(var i=index;i<markers.length-1;i++){
		    markers[i+1].setIndex(index);
			markers[i]=marker[i+1];
		  }  
		  markers.length=markers.length-1;
		  map.removeOverlay(marker);		  
		  replayDraw();
		}	
		
		
		
	    function removePoint(){
		   polyline.remove();
		   polyline=null;
		}
		
		
		
		function addPoint(){
		  var points=[]; 
		  for(var i=0;i<markers.length;i++){
		    points[i]=markers[i].getPoint();			
		  }
		  
		   polyline=new GPolyline(
		    points,
			"#FF0000",
			5,
			0.3		  
		  );		  
		  map.addOverlay( polyline);
		}
		
		
		function replayDraw(){
		  				
		  if(polyline){
 		    removePoint();
		  }
		  addPoint();
		}			
		
		
	
	 //]]>
	-->
	</script>
  </head>

  <body onload="load()" onunload="GUnload()" >
   <div id="map" style="width:800px;height:480px" ></div>
  </body>
</html>
